
@# Daten-Vorlage, rendert die Daten eines Flurst√ºcks

@include basis.cx.html

@def fs_kennzeichen(k) = k.replace('_', '')

@def fs_kennzeichen_list(ks) = ', '.join(ks).replace('_', '')

@def anschrift an
    @for r in records(an)
        @section r.isHistoric
            @table
                @row_value h('person.adresse'), nl(space(r.strasse, r.hausnummer), space(r.plz, r.ort))
                @row_times r
            @end
        @end
    @end
@end

@def person pe
    @section pe.isHistoric
        @for r in records(pe)
            @section r.isHistoric
                @table
                    @row_debug 'person.uid', r.uid
                    @row_value h('person.name'), space(r.anrede, r.akademischerGrad, r.vorname, r.nachnameOderFirma)
                    @row_value h('person.geburtsdatum'), r.geburtsdatum
                    @row_times r
                @end
            @end
        @end
        @with pe.anschriftList
            @h4 h('person.anschrift')
            @for an in pe.anschriftList
                @anschrift an
            @end
        @end
    @end
@end

@def namensnummer nn
    @section nn.isHistoric
        @h3 space(h('namensnummer.title'), text(nn.laufendeNummer))
        @for r in records(nn)
            @section r.isHistoric
                @table
                    @row_debug 'namensnummer.uid', r.uid
                    @row_value h('namensnummer.anteil'), text(r.anteil)
                    @row_value h('namensnummer.rechtsgemeinschaft'), nl(r.artDerRechtsgemeinschaft, r.beschriebDerRechtsgemeinschaft)
                    @row_value h('namensnummer.eigentuemerart'), text(r.eigentuemerart)
                    @row_times r
                @end
            @end
        @end
        @with nn.personList
            @h4 h('person.title')
            @for pe in nn.personList
                @person pe
            @end
        @end
    @end
@end


@def buchungsblatt bb
    @for r in records(bb)
        @section r.isHistoric
            @table
                @row_debug 'buchungsblatt.uid', r.uid
                @row_value h('buchungsblatt.blattart'), text(r.blattart)
                @row_value h('buchungsblatt.buchungsblattbezirk'), text(r.buchungsblattbezirk)
                @row_times r
            @end
        @end
    @end
    @for nn in bb.namensnummerList
        @namensnummer nn
    @end
@end

@def buchungsstelle bs
    @for r in records(bs)
        @section r.isHistoric
            @table
                @row_debug 'buchungsstelle.uid', r.uid
                @row_value h('buchungsstelle.laufendeNummer'), text(r.laufendeNummer)
                @for p in bs.parentkennzeichenList
                    @row_value h('buchungsstelle.zu'), text(p)
                @end
                @row_value h('buchungsstelle.buchungsart'), text(r.buchungsart)
                @row_value h('buchungsstelle.buchungstext'), text(r.buchungstext)
                @row_value h('buchungsstelle.beschreibungDesSondereigentums'), text(r.beschreibungDesSondereigentums)
                @row_value h('buchungsstelle.beschreibungDesUmfangsDerBuchung'), text(r.beschreibungDesUmfangsDerBuchung)
                @row_times r
            @end
        @end
    @end
@end

@def fs_buchung(fs)
    @without fs.buchungList
        @return
    @end

    @h1 h('buchung.title')

    @for bu in fs.buchungList
        @section bu.isHistoric
            @h2 space(h('buchungsblatt.title'), bu.buchungsblatt.buchungsblattkennzeichen)
            @for r in records(bu)
                @buchungsstelle r.buchungsstelle
            @end
            @buchungsblatt bu.buchungsblatt
        @end
    @end
@end


@def fs_basis(fs)
    @for r in records(fs)
        @section r.isHistoric
            @table
                @row_debug 'flurstueck.uid', r.uid
                @row_value h('flurstueck.flurnummer'), text(r.flurnummer)
                @row_value h('flurstueck.zaehler'), text(r.zaehler)
                @row_value h('flurstueck.nenner'), text(r.nenner, '-')
                @row_value h('flurstueck.amtlicheFlaeche'), area(r.amtlicheFlaeche)
                @row_value h('flurstueck.geomFlaeche'), area(r.geomFlaeche)
                @with r.nachfolgerFlurstueckskennzeichen as lst
                    @row_value h('flurstueck.nachfolgerFlurstueckskennzeichen'), fs_kennzeichen_list(lst)
                @end
                @with r.vorgaengerFlurstueckskennzeichen as lst
                    @row_value_historic h('flurstueck.vorgaengerFlurstueckskennzeichen'), fs_kennzeichen_list(lst)
                @end
                @row_times r
            @end
        @end
    @end
@end

@def fs_lage(fs)
    @h1 h('lage.title')

    @table
        @row_value h('flurstueck.gemeinde'),  text(fs.recs[-1].gemeinde)
        @row_value h('flurstueck.gemarkung'), text(fs.recs[-1].gemarkung)
    @end

    @for r in records_from(fs.lageList)
        @section r.isHistoric
            @table
                @row_value h('lage.adresse'), space(r.strasse, r.hausnummer)
                @row_times r
            @end
        @end
    @end
@end

@def fs_gebaeude(fs)
    @without fs.gebaeudeList
        @return
    @end

    @h1 h('gebaeude.title')

    @table
        @row_value h('flurstueck.gebaeudeAmtlicheFlaeche'), area(fs.gebaeudeAmtlicheFlaeche)
        @row_value h('flurstueck.gebaeudeGeomFlaeche'), area(fs.gebaeudeGeomFlaeche)
    @end

    @for r in records_from(fs.gebaeudeList)
        @section r.isHistoric
            @table
                @row_debug 'gebaeude.uid', r.uid
                @row_value h('gebaeude.gebaeudekennzeichen'), text(r.gebaeudekennzeichen)
                @row_value h('gebaeude.amtlicheFlaeche'), area(r.amtlicheFlaeche)
                @row_value h('gebaeude.geomFlaeche'), area(r.geomFlaeche)
                @row_props r
                @row_times r
            @end
        @end
    @end
@end

@def fs_nutzung(fs)
    @without fs.nutzungList
        @return
    @end

    @h1 h('nutzung.title')

    @for nu in fs.nutzungList
        @for r in records(nu)
            @section r.isHistoric
                @table
                    @row_debug 'part.uid', nu.uid
                    @row_value h('nutzung.name'), text(nu.name)
                    @row_value h('nutzung.amtlicheFlaeche'), area(r.amtlicheFlaeche)
                    @row_value h('nutzung.geomFlaeche'), area(r.geomFlaeche)
                    @row_props r
                    @row_times r
                @end
            @end
        @end
    @end
@end

@def flurstueck(fs)
    @section fs.isHistoric
        @fs_basis    fs
        @fs_lage     fs
        @fs_gebaeude fs
        @fs_nutzung  fs
        @fs_buchung  fs
    @end
@end
